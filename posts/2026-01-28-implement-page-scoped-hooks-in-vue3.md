---
date: 2026-01-28
title: Vue 3 å®ç°é¡µé¢çº§ä½œç”¨åŸŸ Hook
tags:
  - Vue3
  - Typescript
  - Hook
description: æœ¬æ–‡ä»‹ç»äº†ä¸€ç§åœ¨ Vue 3 ä¸­å®ç°é¡µé¢çº§ä½œç”¨åŸŸ Hook çš„æ–¹æ¡ˆï¼Œç”¨äºè§£å†³åŒä¸€ç»„ä»¶åœ¨å¤šè·¯ç”±é¡µé¢å¤ç”¨æ—¶çš„çŠ¶æ€éš”ç¦»ä¸è‡ªåŠ¨æ¸…ç†é—®é¢˜ã€‚
---

# Vue 3 å®ç°é¡µé¢çº§ä½œç”¨åŸŸ Hook

åœ¨ Vue 3 é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šå°è£…å„ç§è‡ªå®šä¹‰ Hook æ¥ç®¡ç†ç»„ä»¶é€»è¾‘æˆ–çŠ¶æ€ï¼Œæ¯”å¦‚ `useUserStore`ã€`useForm`ã€`useList` ç­‰ã€‚

ä½†æœ‰æ—¶ä½ å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„éœ€æ±‚ï¼š

> åŒä¸€ä¸ªç»„ä»¶è¢«ä¸åŒè·¯ç”±é¡µé¢å¤ç”¨æ—¶ï¼Œ**å¸Œæœ›æ¯ä¸ªé¡µé¢æ‹¥æœ‰ç‹¬ç«‹çš„çŠ¶æ€**ï¼Œ
>  è€Œä¸æ˜¯æ‰€æœ‰é¡µé¢å…±äº«åŒä¸€ä»½æ•°æ®ã€‚

æ¯”å¦‚ï¼š

- `/article/1` å’Œ `/article/2` ä¸¤ä¸ªè¯¦æƒ…é¡µéƒ½ä½¿ç”¨ `useArticle()`ï¼›
- æˆ‘å¸Œæœ›æ¯ä¸ªé¡µé¢æœ‰å„è‡ªçš„ç¼“å­˜ï¼Œä¸äº’ç›¸å¹²æ‰°ï¼›
- é¡µé¢å…³é—­åè‡ªåŠ¨æ¸…ç†å†…å­˜ã€‚

è¿™æ—¶å€™å°±éœ€è¦é¡µé¢çº§ä½œç”¨åŸŸ Hook



## ä¸€ã€é—®é¢˜èƒŒæ™¯

å…ˆæ¥çœ‹ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ã€‚å½“æˆ‘å®šä¹‰äº†å¦‚ä¸‹çš„è·¯ç”±ï¼š`/library/:id`

é¡µé¢æ ¹æ®IDæ¸²æŸ“å¯¹åº”çš„å†…å®¹ï¼Œè€Œç»„ä»¶æ˜¯åŒä¸€ä¸ªã€‚

æ­¤æ—¶æˆ‘å®šä¹‰ä¸€ä¸ªå…¨å±€å•ä¾‹ hookï¼š

```typescript
function useCounter() {
  const count = ref(0)
  const inc = () => count.value++
  return { count, inc }
}
```

åœ¨é¡µé¢ä¸­ä½¿ç”¨æ—¶ï¼š

```vue
<script setup lang="ts">
const { count, inc } = useCounter()
</script>

<template>
  <button @click="inc">count: {{ count }}</button>
</template>
```

å¦‚æœä½ åœ¨ `/page/1` ç‚¹äº†å‡ æ¬¡ +1ï¼Œ
 ç„¶åè·³åˆ° `/page/2` â€”â€” å‘ç°è®¡æ•°å™¨çš„å€¼è¿˜åœ¨ç»§ç»­ç´¯åŠ  ã€‚

åŸå› å¾ˆç®€å•ï¼š**æ¯ä¸ªé¡µé¢éƒ½åœ¨å¤ç”¨åŒä¸€ä¸ª Hook å®ä¾‹**ï¼Œæ²¡æœ‰éš”ç¦»ã€‚



## äºŒã€é¡µé¢çº§ä½œç”¨åŸŸ Hook çš„å®ç°

æˆ‘ä»¬å¸Œæœ›åšåˆ°ï¼š

1. æ¯ä¸ªè·¯ç”±é¡µé¢å¯¹åº”ä¸€ä¸ªç‹¬ç«‹çš„ Hook å®ä¾‹ï¼›
2. ç¦»å¼€è¯¥é¡µé¢æ—¶è‡ªåŠ¨æ¸…ç†ï¼›
3. ä¸åŒé¡µé¢ä¹‹é—´äº’ä¸å½±å“ã€‚

è¿™å°±å¯ä»¥ç”¨ä¸‹é¢è¿™æ®µæ ¸å¿ƒä»£ç å®ç° ğŸ‘‡

```typescript
import { getCurrentInstance, onUnmounted } from 'vue'
import { useRoute } from 'vue-router'

export function createPageScopedHook<T>(factory: () => T) {
  // è·¯ç”±å”¯ä¸€ key -> Hook å®ä¾‹
  const map = new Map<string, T>()

  return function usePageScopedHook(): T {
    const instance = getCurrentInstance()
    if (!instance) throw new Error('Must be used in setup()')

    const route = useRoute()
    const key = route.fullPath // å¯ä»¥æ¢æˆ route.path + JSON.stringify(params)

    if (!map.has(key)) {
      map.set(key, factory())

      // é¡µé¢å¸è½½æ—¶è‡ªåŠ¨æ¸…é™¤
      onUnmounted(() => {
        map.delete(key)
      }, instance)
    }

    return map.get(key)!
  }
}

```



## ä¸‰ã€åŸç†è§£æ

è¿™æ®µä»£ç çš„æ ¸å¿ƒæ€æƒ³éå¸¸ç®€å•ï¼š

| æ­¥éª¤                             | è¯´æ˜                             |
| -------------------------------- | -------------------------------- |
| åˆ›å»ºä¸€ä¸ªå…¨å±€ `Map`               | ç”¨æ¥å­˜å‚¨æ¯ä¸ªè·¯ç”±é¡µé¢çš„ Hook å®ä¾‹ |
| ä»¥ `route.fullPath` ä½œä¸ºå”¯ä¸€ key | ç¡®ä¿åŒä¸€è·¯ç”±é¡µé¢å¤ç”¨åŒä¸€ä¸ªå®ä¾‹   |
| é¡µé¢ç¬¬ä¸€æ¬¡è¿›å…¥æ—¶è°ƒç”¨ `factory()` | ç”Ÿæˆè¯¥é¡µé¢ä¸“å±çš„ Hook            |
| é¡µé¢å¸è½½æ—¶åˆ é™¤å¯¹åº”å®ä¾‹           | è‡ªåŠ¨é‡Šæ”¾å†…å­˜ï¼Œé¿å…æ³„æ¼           |

è¿™æ ·ï¼Œå½“ä½ åœ¨ä¸åŒé¡µé¢ä½¿ç”¨ç›¸åŒçš„ Hook æ—¶ï¼Œå°±èƒ½è·å¾—å®Œå…¨éš”ç¦»çš„çŠ¶æ€ã€‚



## å››ã€ä½¿ç”¨ç¤ºä¾‹

å®šä¹‰ä¸€ä¸ªé¡µé¢çº§è®¡æ•°å™¨ï¼š

```typescript
const usePageCounter = createPageScopedHook(() => {
  const count = ref(0)
  const inc = () => count.value++
  return { count, inc }
})
```

ç„¶ååœ¨é¡µé¢ç»„ä»¶ä¸­ç›´æ¥ä½¿ç”¨ï¼š

```vue
<script setup lang="ts">
const { count, inc } = usePageCounter()
</script>

<template>
  <button @click="inc">count: {{ count }}</button>
</template>
```

ç°åœ¨ï¼š

- `/page/1` å’Œ `/page/2` çš„è®¡æ•°å„è‡ªç‹¬ç«‹ï¼›
- å½“ä½ ç¦»å¼€ `/page/1`ï¼Œå®ƒçš„çŠ¶æ€ä¼šè‡ªåŠ¨è¢«æ¸…é™¤ï¼›
- å›åˆ° `/page/1` æ—¶ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ Hook å®ä¾‹ã€‚



## äº”ã€çŠ¶æ€ç®¡ç†å±‚çº§åˆ’åˆ†æ€»ç»“

| çŠ¶æ€ç²’åº¦              | ç®¡ç†æ–¹å¼                                | å…¸å‹å·¥å…·/å®ç°                      | ä½¿ç”¨åœºæ™¯                                                  |
| --------------------- | --------------------------------------- | ---------------------------------- | --------------------------------------------------------- |
| **ç»„ä»¶å†…éƒ¨çŠ¶æ€**      | å±€éƒ¨ Hook / `ref` / `reactive`          | `setup()` å†…ç›´æ¥å®šä¹‰               | å®Œå…¨ç‹¬ç«‹çš„ UI çŠ¶æ€ï¼Œå¦‚ modal æ‰“å¼€/å…³é—­ã€è¡¨å•è¾“å…¥å€¼        |
| **é¡µé¢çº§çŠ¶æ€**        | é¡µé¢çº§ Hook / Module å†… Map / KeepAlive | `createPageScopedHook` æˆ–è‡ªç ” hook | é¡µé¢å†…å¤šç»„ä»¶å…±äº«çŠ¶æ€ï¼Œå¦‚å½“å‰æµè§ˆ pathã€åˆ†é¡µä¿¡æ¯ã€ç­›é€‰æ¡ä»¶ |
| **å…¨å±€çŠ¶æ€**          | å…¨å±€ store                              | Pinia / Vuex / Redux               | è·¨é¡µé¢å…±äº«çŠ¶æ€ï¼Œå¦‚ç”¨æˆ·ä¿¡æ¯ã€å…¨å±€é…ç½®ã€é€šçŸ¥                |
| **ä¸´æ—¶ç¼“å­˜ / ä¼šè¯çº§** | sessionStorage / localStorage           | JS API                             | é¡µé¢åˆ·æ–°ä»éœ€ä¿ç•™çš„æ•°æ®ï¼Œå¦‚è¡¨å•è‰ç¨¿ã€ä¸Šæ¬¡æœç´¢æ¡ä»¶          |

